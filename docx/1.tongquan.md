# API Gateway là gì?
- Một hệ thống Microservices trung bình sẽ có một vài cho tới hàng trăm services khác nhau, nếu như client giao tiếp trực tiếp với các service này thì sơ đồ kết nối sẽ cực kỳ khó quản lý. Việc này sẽ dấn tới một số rắc rối với client:
  - Phần code phía client sẽ trở nên phức tạp hơn vì phải tracking nhiều endpoint
  - Sẽ tạo sự kết nối giữa client và backend. Client cần biết được các services đó đc phân chia như thế nào. Khó khăn cho việc maintain của client và refactor service.
  - Mỗi một service sẽ phải handle nhiều vấn đề liên quan như authentication, SSL hay client rate limiting

**Giải pháp được đưa ra để giải quyết vấn đề này là sử dụng API Gateway***

- ```API Gateway``` làm nhiệm vụ định tuyến các yêu cầu, kết hợp và chuyển đổi các giao thức. Tất cả yêu cầu từ client đều đi qua cổng kết nối API. Sau đó cổng kết nối API định tuyến các yêu cầu này tới Microservices phù hợp. Cổng kết nối API Gateway sẽ xử lý một yêu cầu người dùng bằng cách gọi đến một loạt microservices rồi tổng hợp các kết quả. Nó có thể chuyển đổi giữa các giao thức web như HTTP, WebSocket và các giao thức nội bộ không thân thiện với web.
- Một số tính năng ưu điểm nổi bật của API Gateway
  - Tối ưu đầu cuối: Khi một request của Client tới dịch vụ yêu cầu thông tin của nhiều thành phần trong hệ thống, ví dụ: Customer, Order, Invoices... API Gateway sẽ thực hiện request đồng thời tới các thành phần, lấy về các thông tin từ từng thanh phần, ghép lại và phản hồi lại kết quả mong muốn cho Client
  - Ngắt kết nối API: Khi mỗi thành phần trong hệ thống dừng hoạt động hoặc trả về số lượng lớn lỗi đạt đến ngưỡng đã được quy định, API Gateway có thể tự động thực hiện dừng gửi request tới các thành phần gặp lỗi. Việc này sẽ cho đội vận hành có thời gian để phân tích log, xử lý lỗi và update lại thành phần
  - Thuận tiện nâng cấp các thành phần: Khi các thành phần trong dịch vụ được nâng cấp, phát triển thêm tính năng, API Gateway có các hình thức để điều phối tỉ lệ các request giữa phiên bản hiện tại và phiên bản mới.
  - Kết nối tập trung: Client sử dụng API sẽ kết nối tập trung qua API Gateway, API Gateway thực hiện các công việc xác thực request của client, log các request, giám sát các Microservice, báo cáo/phân tích log...
  - Cân bằng tải: API Gateway có thể phối hợp cùng Service-discovery tool để thực hiện cân bằng tải, phân phối request tới các cụm API
- Nhược điểm của API Gateway là nó sẽ trở thành nút thắt cổ chai khi phát triển hệ thống vì mọi request đều đi qua nó. Vì vậy độ trễ của mỗi request sẽ tăng lên.

# Kong API Gateway
- Kong là giải pháp API Gateway mã nguồn mở phổ biến nhất hiện nay. Kong sẽ đứng trước hệ thống API giúp nhanh chóng, thuận tiện và bảo mật trong triển khai mô hình Microservices, cũng như quản lý và triển khai các giải pháp API.
![alts](../images/kong1.PNG)
- Kong được xây dựng dựa trên Nginx và hoạt động thông qua các RESTful API đơn giản, dễ sử dụng. Một số tính năng cơ bản của Kong bao gồm:
  - Authentication: Bảo vệ các dịch vụ của bạn qua tầng xác thực
  - Trafic Control: Quản lý, điều chỉnh và chặn các lưu lượng API vào ra
  - Analytics: Show, kiểm tra và giám sát các lưu lượng vào API
  - Transformations: Chuyển đổi trực tiếp các yêu cầu và phản hồi API trong khi xử lý
  - Logging: Bắt luồng yêu cầu và phản hồi dữ liệu vào hệ thống ghi log
  - Serverless: Thực hiện các chức năng Serverless thông qua các API
- Một số ưu điểm khi sử dụng Kong:
  - Scalable: Kong có thể dễ dàng mở rộng theo chiều ngang bằng cách thêm nhiều nodes mới. Kong có thể xử lý một lượng lớn request với độ trễ thấp
  - Modular: Bổ sung thêm các tính năng vào Kong thông qua việc cài đặt các plugin và cấu hình dễ dàng thông qua RESTful Admin API
  - Hoạt động trên mọi hạ tầng: Có thể dễ dàng triển khai Kong trên môi trường Cloud, On-premises, hoặc Hybrid

*Các thành phần cơ bản khi triển khai Kong API gateway*

# Tham khảo 
- https://www.dotnetcoban.com/2019/10/kong-api-gateway.html